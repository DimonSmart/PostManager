@page "/tenants/new"
@inject TenantService TenantService
@inject TenantState TenantState
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<PageTitle>New tenant</PageTitle>

<MudStack Spacing="2">
    <MudText Typo="Typo.h4">Create tenant</MudText>
    <MudPaper Class="pa-4">
        <EditForm Model="Model" OnValidSubmit="CreateTenant">
            <TenantForm Model="Model" />
            <MudStack Row="true" Spacing="2" Class="mt-4">
                <MudButton Color="Color.Primary" Variant="Variant.Filled" ButtonType="ButtonType.Submit">Create</MudButton>
                <MudButton Color="Color.Secondary" Variant="Variant.Text" ButtonType="ButtonType.Button" OnClick="Cancel">Cancel</MudButton>
            </MudStack>
        </EditForm>
    </MudPaper>
</MudStack>

@code {
    private TenantFormModel Model { get; set; } = new();

    private async Task CreateTenant()
    {
        if (string.IsNullOrWhiteSpace(Model.Name))
        {
            Snackbar.Add("Tenant name is required.", Severity.Warning);
            return;
        }

        var tenant = await TenantService.CreateTenantAsync(Model.Name, Model.SettingsJson, CancellationToken.None);
        TenantState.SetTenant(tenant.Id, tenant.Name);
        Navigation.NavigateTo($"/tenants?selectedId={tenant.Id}");
    }

    private void Cancel()
    {
        Navigation.NavigateTo("/tenants");
    }
}
